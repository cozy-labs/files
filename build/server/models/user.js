// Generated by CoffeeScript 1.7.1
var User, americano, hideEmail;

americano = require('americano-cozy-pouchdb');

module.exports = User = americano.getModel('User', {
  email: String,
  password: String,
  salt: String,
  public_name: String,
  timezone: String,
  owner: Boolean,
  activated: Boolean
});

User.first = function(callback) {
  return User.request('all', function(err, users) {
    if (err != null) {
      return callback(new Error(err));
    } else if (!users || users.length === 0) {
      return callback(null, null);
    } else {
      return callback(null, users[0]);
    }
  });
};

User.getDisplayName = function(callback) {
  return User.first(function(err, user) {
    var name, words, _ref;
    if (user != null) {
      if (((_ref = user.public_name) != null ? _ref.length : void 0) > 0) {
        name = user.public_name;
      } else {
        name = hideEmail(user.email);
        words = name.split(' ');
        name = words.map(function(word) {
          return word.charAt(0).toUpperCase() + word.slice(1);
        }).join(' ');
      }
      return callback(null, name);
    } else {
      return callback(null, null);
    }
  });
};

hideEmail = function(email) {
  return email.split('@')[0].replace('.', ' ').replace('-', ' ');
};
